# 최적화는 신중히 하라

> (맹목적인 어리석음을 포함해) 그 어떤 핑계보다 효율성이라는 이름 아래 행해진 컴퓨팅 죄악이 더 많다.

> (전체의 97% 정도인) 자그마한 효율성은 모두 잊자. 섣부른 최적화가 만악의 근원이다.

> 최적화를 할 때는 다음 두 규칙을 따르라.<br>
첫 번째, 하지마라.<br>
두 번째, (전문가 한정) 아직 하지 마라. 다시 말해, 완전히 명백하고 최적화되지 않은 해법을 찾을 때까지는 하지 마라.<br>

최적화는 좋은 결과보다는 해로운 결과로 이어지기 쉽고, 섣불리 진행하면 더 그렇다.<br>
빠르지도 않고 제대로 동작하지도 않으면서 수정하기는 어려운 소프트웨어를 탄생시키는 것이다.

## 빠른 프로그램보다는 좋은 프로그램을 작성하라.

- 좋은 프로그램이지만 성능이 나오지 않는다면 그 아키텍처 자체가 최적화할 수 있는 길을 안내해줄 것이다. <br>
좋은 프로그램은 내부를 독립적으로 설계할 수 있기 때문에, 시스템의 나머지에 영향을 주지 않고도 각 요소를 다시 설계할 수 있다.

- 아키텍처 결함이 성능을 제한하는 상황이라면, 시스템 전체를 다시 작성하지 않고는 해결할 수 없다.<br>
&rarr; 따라서 설계 단계에서도 성능을 완전히 무시해서는 안된다.

---
## 성능 제한하는 설계를 피하라.

API, 네트워크 프로토콜, 영구 저장용 데이터 포맷 등은 완성 후에 변경하기 어렵거나 불가능할 수 있으며, 동시에 시스템 성능을 심각하게 제한할 수 있다.

---
## API를 설계할 때 성능에 주는 영향을 고려하라.

- public 타입을 가변으로 만들면, 즉 내부 데이터를 변경할 수 있게 만들면 불필요한 방어적 복사를 수없이 유발할 수 있다.
- 컴포지션으로 해결할 수 있으면 상속을 사용하지 말고 컴포지션을 사용해라.
- 인터페이스도 있는데 굳이 구현 타입을 사용하는 것은 좋지 않다.

### API의 잘못된 설계가 성능의 영향을 주는 예

- java.awt.Component에서 getSize 메서드는 Dimension 인스턴스를 반환한다.<br>
Dimension은 가변으로 설계했으니 getSize를 호출하는 모든 곳에서 Dimension 인스턴스를 새로 생성해야만 한다.<br>
&rarr; 성능 문제 발생!

&rarr; 원래 내렸던 API 설계 결정의 폐해를 감내해야 한다.

- 잘 설계된 API는 성능도 좋은게 보통이다.
&rarr; 따라서 성능을 위해 API를 왜곡하는 건 매우 안 좋은 생각이다.
- 성능 문제는 다음 버전에서 사라질 수도 있지만 왜곡된 API를 지원하는 고통은 영원히 지속된다.

## 성능 측정

**각각의 최적화 시도 전후로 성능을 측정해라**
- 성능 최적화의 측정 결과가 눈에 띄게 높아지는 경우는 적다.<br>
시간을 잡아먹는 부분을 추측하기 어렵기 때문이다.

- 프로파일링 도구는 최적화 노력을 어디에 집중해야 할지 찾는 데 도움을 준다.<br>
이 도구는 개별 메서드의 소비 시간과 호출 횟수 같은 런타임 정보를 제공하여, 집중할 곳은 물론 알고리즘을 변경해야 한다는 사실을 알려주기도 한다.

자바는 성능 예측을 하기 어려우므로 성능을 측정해 보는 것이 중요하다.
